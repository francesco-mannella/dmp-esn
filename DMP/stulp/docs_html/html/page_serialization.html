<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>DMP_BBO library: Serialization</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">DMP_BBO library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Serialization </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Serialization and deserialization of objects serves two purposes in this code:</p>
<ul>
<li>Reading parameter/experiment settings from a file. For instance, you could specify the MetaParameters of a FunctionApproximator in a file, read that file in your program, and train a FunctionApproximator with those MetaParameters. To try different MetaParameters settings you only have to change the input file, without having to recompile. To be able to edit such parameter files, the files should be human readable. Ideally, it should be JSON, because it is very readable and compact.</li>
</ul>
<ul>
<li>Saving the results of an experiment. Saving such results to binary files would be more compact, but to ensure that the same format is used for both serialization and deserialization, we use a human-readable format here also.</li>
</ul>
<p>I considered the following options.</p>
<ul>
<li>Boost property tree: it makes a mess of arrays when saving to JSON</li>
</ul>
<ul>
<li>Google protobuf: I preferred to not have code generated for me</li>
</ul>
<ul>
<li>cereal: <a href="http://uscilab.github.io/cereal/,">http://uscilab.github.io/cereal/,</a> external library. Really the best option, but I tried to avoid users having to use non-standard libraries.</li>
</ul>
<ul>
<li>jsoncpp: Not ideal for serialization, more for read/write of JSON.</li>
</ul>
<p>In summary, I could not find any libraries that were easy to install and could serialize to/from JSON. Therefore, I went for the second choice, which was XML. Because boost is a standard, and compiles on most platforms, I decided to use boost:: serialization. I consider this to be quite a compromise, because I find boost::serialization quite messy, it is not well documented, and it took me quite a while to get it working properly (especially the registering of derived classes, for which you have to use a wierd combination of macros in the exact right places)</p>
<p>Since I was writing to XML with boost::serialization anyway, many classes implement a toString() method that simply returns the XML code (without a header) that results from serialization. The RETURN_STRING_FROM_BOOST_SERIALIZATION_XML macro does all the work for writing to an XML archive and converting it to a string. Having XML as output is not ideal, but it avoid lots of duplicate code. Perhaps boost::serialization will one day be able to write to JSON also, and then this could be used instead.</p>
<p>I decided to go for string toString(void) instead of ostream&amp; toStream(ostream&amp;), because toString allows you to easily use both the output stream operator (output &lt;&lt; obj.toString()) and printf (printf("%s",obj.toString()), whereas toStream would be much more messy to use in combination with printf (not everyone likes to use the outputstream operator).</p>
<h1><a class="anchor" id="sec_boost_serialization_ugliness"></a>
Boost serialization issues</h1>
<p>With boost::serialization, it is possible to serialize classes without a default constuctor with <a href="http://www.boost.org/doc/libs/1_55_0/libs/serialization/doc/serialization.html#constructors">http://www.boost.org/doc/libs/1_55_0/libs/serialization/doc/serialization.html#constructors</a> But load_construct_data requires the creation of an object, which we cannot when classes are abstract. It seems no-one knows how to solve this: </p><ul>
<li><a href="http://lists.boost.org/boost-users/2005/09/13827.php">http://lists.boost.org/boost-users/2005/09/13827.php</a> </li>
<li><a href="http://boost.2283326.n4.nabble.com/serialization-Serializing-classes-with-no-default-constructors-td2557921.html">http://boost.2283326.n4.nabble.com/serialization-Serializing-classes-with-no-default-constructors-td2557921.html</a></li>
</ul>
<p>For this reason abstract base classes that are to be serialized with boost must have a default constructor, and may not have const members. This is really a pain, because a serialization library should not enforce such design decisions... But this is the way it is in the code.</p>
<h1><a class="anchor" id="sec_eigen_boost_serialization"></a>
Serializing boost matrices</h1>
<p>To avoid bloating the serialization of Eigen matrices with lots of XML tags, they are serialized in a special way. The following examples show how Eigen matrices are serialized in XML:</p>
<ul>
<li>Standard matrix: <div class="fragment"><div class="line">&lt;m&gt;2X3; 0 0 0; 1 1 1&lt;/m&gt;</div>
</div><!-- fragment --></li>
</ul>
<ul>
<li>Vector: <div class="fragment"><div class="line">&lt;m&gt;3X1; 0 0 0&lt;/m&gt;</div>
<div class="line">&lt;m&gt;1X3; 0 0 0&lt;/m&gt;</div>
</div><!-- fragment --></li>
</ul>
<ul>
<li>Diagonal matrix (only the diagonal is saved, indicated with D instead of X: <div class="fragment"><div class="line">&lt;m&gt;3D3; 1 2 3&lt;/m&gt;</div>
</div><!-- fragment --> </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon May 9 2016 10:16:52 for DMP_BBO library by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
