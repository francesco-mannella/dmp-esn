<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>DMP_BBO library: Black Box Optimization</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">DMP_BBO library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Black Box Optimization </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This module implements several <a href="http://en.wikipedia.org/wiki/Evolution_strategy">evolution strategies</a> for the <a href="http://en.wikipedia.org/wiki/Optimization_%28mathematics%29">optimization</a> of black-box <a href="http://en.wikipedia.org/wiki/Loss_function">cost functions</a>.</p>
<p>Black-box in this context means that no assumptions about the cost function can be made, for example, we do not have access to its derivative, and we do not even know if it is continuous or not.</p>
<p>The evolution strategies that are implemented are all based on reward-weighted averaging (aka probablity-weighted averaging), as explained in this paper/presentation: <a href="http://icml.cc/discuss/2012/171.html">http://icml.cc/discuss/2012/171.html</a></p>
<p>The basic algorithm is as follows: </p><div class="fragment"><div class="line">x_mu = ??; x_Sigma = ?? <span class="comment">// Initialize multi-variate Gaussian distribution</span></div>
<div class="line"><span class="keywordflow">while</span> (!halt_condition) {</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Explore</span></div>
<div class="line">    <span class="keywordflow">for</span> k=1:K {</div>
<div class="line">        x[k]     ~ N(x_mu,x_Sigma)    <span class="comment">// Sample from Gaussian</span></div>
<div class="line">        costs[k] = costfunction(x[k]) <span class="comment">// Evaluate sample</span></div>
<div class="line">    }</div>
<div class="line">        </div>
<div class="line">    <span class="comment">// Update distribution</span></div>
<div class="line">    weights = costs2weights(costs) <span class="comment">// Should assign higher weights to lower costs</span></div>
<div class="line">    x_mu_new = weights^T * x; <span class="comment">// Compute weighted mean of samples</span></div>
<div class="line">    x_covar_new = (weights .* x)^T * weights <span class="comment">// Compute weighted covariance matrix of samples</span></div>
<div class="line">    </div>
<div class="line">    x_mu = x_mu_new</div>
<div class="line">    x_covar = x_covar_new</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="sec_bbo_implementation"></a>
Implementation</h1>
<p>The algorithm above has been implemented as follows (see runEvolutionaryOptimization() and <a class="el" href="demoEvolutionaryOptimization_8cpp.html" title="Demonstrates how to run an evolution strategy to optimize a distance function, implemented as a CostF...">demoEvolutionaryOptimization.cpp</a>): </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> n_dim = 2; <span class="comment">// Optimize 2D problem</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// This is the cost function to be optimized</span></div>
<div class="line">CostFunction* cost_function = <span class="keyword">new</span> CostFunctionQuadratic(VectorXd::Zero(n_dim));</div>
<div class="line"></div>
<div class="line"><span class="comment">// This is the initial distribution</span></div>
<div class="line">DistributionGaussian* distribution = <span class="keyword">new</span> DistributionGaussian(VectorXd::Random(n_dim),MatrixXd::Identity(n_dim)) </div>
<div class="line"></div>
<div class="line"><span class="comment">// This is the updater which will update the distribution</span></div>
<div class="line">double eliteness = 10.0;</div>
<div class="line">Updater* updater = new UpdaterMean(eliteness);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Some variables</span></div>
<div class="line">MatrixXd samples;</div>
<div class="line">VectorXd costs;</div>
<div class="line"></div>
<div class="line">for (<span class="keywordtype">int</span> i_update=1; i_update&lt;=n_updates; i_update++)</div>
<div class="line">{</div>
<div class="line">  </div>
<div class="line">    <span class="comment">// 1. Sample from distribution</span></div>
<div class="line">    <span class="keywordtype">int</span> n_samples_per_update = 10;</div>
<div class="line">    distribution-&gt;generateSamples(n_samples_per_update, samples);</div>
<div class="line">  </div>
<div class="line">    <span class="comment">// 2. Evaluate the samples</span></div>
<div class="line">    cost_function-&gt;evaluate(samples,costs);</div>
<div class="line">  </div>
<div class="line">    <span class="comment">// 3. Update parameters</span></div>
<div class="line">    updater-&gt;updateDistribution(*distribution, samples, costs, *distribution);</div>
<div class="line">    </div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="sec_bbo_task_and_task_solver"></a>
CostFunction vs Task/TaskSolver</h2>
<p>When the cost function has a simple structure, e.g. cost = <img class="formulaInl" alt="$ x^2 $" src="form_1.png"/> it is convenient to implement the function <img class="formulaInl" alt="$ x^2 $" src="form_1.png"/> in CostFunction::evaluate(). In robotics however, it is more suitable to make the distinction between a task (e.g. lift an object), and an entity that solves this task (e.g. your robot, my robot, a simulated robot, etc.). For these cases, the CostFunction is split into a Task and a TaskSolver, as follows:</p>
<div class="fragment"><div class="line">CostFunction::evaluate(samples,costs) {</div>
<div class="line">  TaskSolver::performRollouts(samples,cost_vars)</div>
<div class="line">  Task::evaluate(cost_vars,costs)</div>
<div class="line">}</div>
</div><!-- fragment --><p>The idea here is that the TaskSolver uses the samples to perform a rollout (e.g. the samples represent the parameters of a policy which is executed) and computes all the variables that are relevant to determining the cost (e.g. it records the forces at the robot's end-effector, if this is something that needs to be minimized)</p>
<p>Some further advantages of this approach: </p><ul>
<li>Different robots can solve the exact same Task implementation of the same task. </li>
<li>Robots do not need to know about the cost function to perform rollouts (and they shouldn't) </li>
<li>The intermediate cost-relevant variables can be stored to file for visualization etc. </li>
<li>The procedures for performing the roll-outs (on-line on a robot) and doing the evaluation/updating/sampling (off-line on a computer) can be seperated, because there is a separate TaskSolver::performRollouts function.</li>
</ul>
<p>When using the Task/TaskSolver approach, the runEvolutionaryOptimization process is as follows (only minor changes to the above): </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> n_dim = 2; <span class="comment">// Optimize 2D problem</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// This is the cost function to be optimized</span></div>
<div class="line">CostFunction* cost_function = <span class="keyword">new</span> CostFunctionQuadratic(VectorXd::Zero(n_dim));</div>
<div class="line"></div>
<div class="line"><span class="comment">// This is the initial distribution</span></div>
<div class="line">DistributionGaussian* distribution = <span class="keyword">new</span> DistributionGaussian(VectorXd::Random(n_dim),MatrixXd::Identity(n_dim)) </div>
<div class="line"></div>
<div class="line"><span class="comment">// This is the updater which will update the distribution</span></div>
<div class="line">double eliteness = 10.0;</div>
<div class="line">Updater* updater = new UpdaterMean(eliteness);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Some variables</span></div>
<div class="line">MatrixXd samples;</div>
<div class="line">VectorXd costs;</div>
<div class="line"></div>
<div class="line">for (<span class="keywordtype">int</span> i_update=1; i_update&lt;=n_updates; i_update++)</div>
<div class="line">{</div>
<div class="line">  </div>
<div class="line">    <span class="comment">// 1. Sample from distribution</span></div>
<div class="line">    <span class="keywordtype">int</span> n_samples_per_update = 10;</div>
<div class="line">    distribution-&gt;generateSamples(n_samples_per_update, samples);</div>
<div class="line">  </div>
<div class="line">    <span class="comment">// 2A. Perform the roll-outs</span></div>
<div class="line">    task_solver-&gt;performRollouts(samples,cost_vars);</div>
<div class="line">  </div>
<div class="line">    <span class="comment">// 2B. Evaluate the samples</span></div>
<div class="line">    task-&gt;evaluate(cost_vars,costs);</div>
<div class="line">  </div>
<div class="line">    <span class="comment">// 3. Update parameters</span></div>
<div class="line">    updater-&gt;updateDistribution(*distribution, samples, costs, *distribution);</div>
<div class="line">    </div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon May 9 2016 10:16:52 for DMP_BBO library by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
